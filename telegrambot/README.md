
# Модуль "Телеграм бот"
Необходима Java версии не менее 11.
Настройки модуля находятся в файле application.properties.

### Первичная подготовка телеграм бота и группового чата к работе
 
 **1. Подготовка телеграм бота.** Необходимо создать телеграм бота, написав в телеграм @BotFather команду /newbot (подробное описание https://core.telegram.org/bots),
 задать имя, используемое для обнаружения бота в телеграме, задать имя, используемое в коде (telegram.username), после чего будет предоставлен уникальный 
 токен бота (telegram.token).
 
 **2.** Для разрешения бота получать все сообщения в групповом чате, ему необходимо настроить параметр конфиденциальности.
 C помощью @BotFather выполнить команду /setprivacy и установить параметр бота в DISABLE.
 
 **3. Подготовка группового чата.** Необходимо создать групповой чат (New Group), задать ему имя. 
  В настройках параметров группового чата установить разрешения участников (Manage group -> Permissions) (выставить все флаги в false).
  Сделать групповой чат супергруппой для этого:
  - Или зайти в Telegram через web-версию, выбрать групповой чат, зайти в Group Info, нажать Upgrade to supergroup;
  - Или сделать группу публичной, после чего сделать ее снова приватной (Manage group -> Group type).  
  
 **4.** Добавить бота по его имени в чат и дать ему права администатора. 
 
 **5.** Убрать возможность добавлять телеграм бота в чаты. 
 C помощью @BotFather выполнить команду /setjoingroups и установить параметр бота в DISABLE.
 
 **6.** Установить в файле application.properties телеграм бота настройки telegram.username и telegram.token.
 
 **7.** Запустить приложение (параметр telegram.main.enabled=true). После запуска выполнить команду /get_chat_id в групповом чате. Полученный Id внести в настройку
 telegram.chat.id.
 
 **8.** Перезапустить приложение. После этого телеграм бот готов к работе.
 
### Особенности бота

 - Все сообщения, не объявленные в коде как команды бота, удаляются.
 - Для отображения удобной подсказки команд в чате необходимо c помощью @BotFather выполнить 
 команду /setcommands и написать команды в соответствии с шаблоном:

       <Команда1> - <Описание1>
       <Команда2> - <Описание2>
       <КомандаN> - <ОписаниеN>
       Пример: 
       help - Список команд
       get_chat_id - Получение ID чата
       
   Команды, состоящие из нескольких слов (get_chat_id) записывать, используя Snake case.
   При добавлении новой команды боту, для обновления списка команд, необходимо вносить **ВЕСЬ** список команд.
   
### Вспомогательные команды
 Изначально бот содержит следующие вспомогательные команды:
 
    /start - Начало работы (при первичном запуске бота)
    /help - Список команд
    /get_chat_id - Получение ID чата

### Описание настроек:

 **1. Настройки телеграм бота:**
 
 - spring.main.web-application-type - Убирает конфликт зависимостей spring-boot-starter-web 
 и telegrambots-spring-boot-starter (none)
 
 - telegram.username - Имя телеграм бота
 
 - telegram.token - Токен телеграм бота
 
 - telegram.chat.id - Id группового чата, в который будут приходить сообщения
 
 - telegram.main.enabled - Включение работы телеграм бота

 - telegram.scheduler.enabled - Флаг вкл/откл выполнения заданий по расписанию
 
 - telegram.delay - Время между запусками заданий по расписанию
 

**Сборка**  
Перед тем как запустить сборку нужно проверить файл .m2/toolchains.xml
В нем необходимо прописать все используемые вами версии jdk.

    Например
    <?xml version="1.0" encoding="UTF8"?>
    <toolchains>
      <!-- JDK toolchains -->
      
      <toolchain>
        <type>jdk</type>
        <provides>
          <version>11</version>
          <vendor>openjdk</vendor>
        </provides>
        <configuration>
          <jdkHome>/usr/lib/jvm/java-1.11.0-openjdk-amd64</jdkHome>
        </configuration>
      </toolchain>
     
    </toolchains>
Для сборки jar файла - **mvn clean install**. 
